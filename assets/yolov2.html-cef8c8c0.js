import{_ as e,r as i,o as m,c as r,a as s,b as a,d as l,e as n}from"./app-aa9cafec.js";const p="/MLblogs/assets/2024-01-22-21-02-58-image-ffcb6f14.png",c="/MLblogs/assets/2024-01-22-17-04-20-image-628a7e74.png",o="/MLblogs/assets/2024-01-21-16-53-48-image-441448b7.png",h="/MLblogs/assets/2024-01-22-21-09-05-image-efd63aa8.png",g={},u={class:"custom-container info"},d=s("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},[s("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[s("circle",{cx:"12",cy:"12",r:"9"}),s("path",{d:"M12 8h.01"}),s("path",{d:"M11 12h1v4h1"})])],-1),v=s("p",{class:"custom-container-title"},"INFO",-1),y={href:"https://www.bilibili.com/video/BV1FL411N7Mu/?p=11&spm_id_from=pageDriver&vd_source=29624dbb703a504c9a36c90ccf9558d4",target:"_blank",rel:"noopener noreferrer"},x={href:"https://zhuanlan.zhihu.com/p/35325884",target:"_blank",rel:"noopener noreferrer"},b={href:"https://zhuanlan.zhihu.com/p/74540100",target:"_blank",rel:"noopener noreferrer"},_=s("p",null,"v2主要是各种trick引入后的效果验证，建议不必纠结于v2的网络结构。",-1),w={href:"https://link.zhihu.com/?target=https%3A//arxiv.org/abs/1612.08242",target:"_blank",rel:"noopener noreferrer"},z=s("strong",null,"检测与分类联合训练方法",-1),f=n('<p>yolov2的改进细节如下：</p><h2 id="全卷积-bn" tabindex="-1"><a class="header-anchor" href="#全卷积-bn" aria-hidden="true">#</a> 全卷积+BN</h2><p><strong>舍弃dropout，卷积之后全部加入BN</strong>。网络的每一层输入都做了归一化，收敛相对容易。经过BN处理后，网络会提升2.4%的mAP</p><h2 id="大分辨率" tabindex="-1"><a class="header-anchor" href="#大分辨率" aria-hidden="true">#</a> 大分辨率</h2><p><strong>使用更大分辨率</strong>。在Yolov1中，网络的backbone部分会在ImageNet数据集上进行预训练，训练时网络输入图像的分辨率为224x224。在v2中，将分类网络在输入图片分辨率为448x448的ImageNet数据集上训练10个epoch，再使用检测数据集（例如coco）进行微调。高分辨率预训练使mAP提高了大约4%。</p><h2 id="darknet19" tabindex="-1"><a class="header-anchor" href="#darknet19" aria-hidden="true">#</a> DarkNet19</h2><p><strong>使用DarkNet19作为backbone</strong>，包括19个卷积层和5个maxpooling层，Darknet-19与VGG16模型设计原则是一致的，主要采用3x3卷积，<strong>采用2x2的maxpooling层之后，特征图维度降低2倍</strong>，而同时将<strong>特征图的channles增加两倍</strong>。Darknet-19最终采用global avgpooling做预测，并且在3x3卷积之间使用1x1卷积来压缩特征图channles以降低模型计算量和参数。Darknet-19每个卷积层后面同样使用了batch norm层以加快收敛速度，降低模型过拟合。使用Darknet19之后，模型的mAP没有提升多少，但是计算量降低了很多。</p>',7),O=s("p",null,[s("strong",null,"5次降采样"),a("（每一次特征图大小变为原来的0.5），最终输出的特征图大小是输入图像的"),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mfrac",null,[s("mn",null,"1"),s("mn",null,"32")])]),s("annotation",{encoding:"application/x-tex"},"\\frac{1}{32}")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1.1901em","vertical-align":"-0.345em"}}),s("span",{class:"mord"},[s("span",{class:"mopen nulldelimiter"}),s("span",{class:"mfrac"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8451em"}},[s("span",{style:{top:"-2.655em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"32")])])]),s("span",{style:{top:"-3.23em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"frac-line",style:{"border-bottom-width":"0.04em"}})]),s("span",{style:{top:"-3.394em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"1")])])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.345em"}},[s("span")])])])]),s("span",{class:"mclose nulldelimiter"})])])])]),a("。作者使用输入大小为416x416，输出大小为13x13。"),s("strong",null,"没有FC层"),a("。")],-1),k=n('<h2 id="先验框" tabindex="-1"><a class="header-anchor" href="#先验框" aria-hidden="true">#</a> 先验框</h2><p>v1每个格点预测两个矩形框，在计算loss时，只让与ground truth最接近的框产生loss数值，而另一个框不做修正。在v2中，<strong>不对矩形框的宽高的绝对值进行预测</strong>，而是预测与Anchor框的偏差（offset），每个格点指定n个Anchor框。在训练时，<strong>最接近ground truth的框产生loss</strong>，其余框不产生loss。在引入Anchor Box操作后，mAP由69.5下降至69.2，原因在于，<strong>每个格点预测的物体变多之后，召回率大幅上升</strong>，准确率有所下降，总体mAP略有下降。</p><p><strong>k-means聚类提取先验框</strong>。在V1中，每一个grid cell预测<strong>两个不同的bbox</strong>。在Faster R-CNN和SSD中，先验框的维度（长和宽）都是<strong>手动设定</strong>的，一共设定三个面积大小的矩形框，每个矩形框有三个宽高比：1:1，2:1，1:2，总共九个框，<strong>带有一定的主观性</strong>。V2将训练数据集中的矩形框全部拿出来，用<strong>kmeans聚类</strong>得到先验框的宽和高。聚类必须要定义聚类点（矩形框 ）之间的距离函数，作者选用GT box与聚类中心box之间的IOU值作为距离指标。对比了采用聚类分析得到的先验框与手动设置的先验框在平均IOU上的差异，发现前者的<strong>平均IOU值更高，因此模型更容易训练学习</strong>。yolov2选择<strong>每一个cell</strong>设置5个先验框。</p><img title="" src="'+p+'" alt="" data-align="center" width="476"><h2 id="特征融合" tabindex="-1"><a class="header-anchor" href="#特征融合" aria-hidden="true">#</a> 特征融合</h2><p>最后一层感受野太大，小目标可能丢失，需要<strong>融合之前的特征</strong>。对于小物体还需要更精细的特征图（Fine-Grained Features），因此SSD使用了多尺度的特征图来分别检测不同大小的物体，前面更精细的特征图可以用来预测小物体。</p><p>YOLOv2提出了一种<strong>passthrough</strong>层（以前面更高分辨率的特征图为输入，然后将其连接到后面的低分辨率特征图上）来利用更精细的特征图。YOLOv2所利用的Fine-Grained Features是26x26大小的特征图（<strong>最后一个maxpooling层的输入</strong>），对于Darknet-19模型来说就是大小为26x26x512的特征图。</p><p>passthrough层抽取前面层的每个 2x2 的局部区域，然后将其转化为channel维度：</p><img title="" src="'+c+'" alt="" data-align="center"><p>对于 26x26x512 的特征图，经passthrough层处理之后就变成了 13x13x2048 的新特征图（<strong>特征图大小降低4倍，而channles增加4倍</strong>）。这样就可以与后面的 13x13x1024 特征图连接在一起形成 <strong>13x13x3072</strong> 大小的特征图，然后在此特征图基础上卷积做预测。</p><p>其融合步骤是将浅层的特征图在空间维度上拆分，使得其尺度和深层特征图的尺度相同，然后沿着通道维度拼接：</p><img src="'+o+'" title="" alt="" data-align="center"><p>另外，作者在后期的实现中借鉴了ResNet网络，不是直接对高分辨特征图处理，而是增加了一个中间卷积层，先采用64个 1x1 卷积核进行卷积，然后再进行passthrough处理，这样 26x26x512 的特征图得到 13x13x256 的特征图。</p><h2 id="多尺度训练" tabindex="-1"><a class="header-anchor" href="#多尺度训练" aria-hidden="true">#</a> 多尺度训练</h2><p><strong>多尺度训练</strong>。具体来说就是在训练过程中每间隔一定的iterations之后改变模型的输入图片大小。输入图片最小为 320x320 ，此时对应的特征图大小为  10x10，而输入图片最大为 608x608 ，对应的特征图大小为 19x19 。在训练过程，每隔10个iterations随机选择一种输入图片大小，然后只需要修改对最后检测层的处理就可以重新训练。</p><h2 id="位置预测" tabindex="-1"><a class="header-anchor" href="#位置预测" aria-hidden="true">#</a> 位置预测</h2>',16),L=s("p",null,[a("YOLOv2借鉴RPN网络使用anchor boxes来预测边界框相对先验框的offsets："),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msub",null,[s("mi",null,"t"),s("mi",null,"x")]),s("mo",{separator:"true"},","),s("msub",null,[s("mi",null,"t"),s("mi",null,"y")]),s("mo",{separator:"true"},","),s("msub",null,[s("mi",null,"t"),s("mi",null,"h")]),s("mo",{separator:"true"},","),s("msub",null,[s("mi",null,"t"),s("mi",null,"w")])]),s("annotation",{encoding:"application/x-tex"},"t_x,t_y,t_h,t_w")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.9012em","vertical-align":"-0.2861em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"t"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.1514em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight"},"x")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mpunct"},","),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"t"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.1514em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.03588em"}},"y")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.2861em"}},[s("span")])])])])]),s("span",{class:"mpunct"},","),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"t"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3361em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight"},"h")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mpunct"},","),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"t"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.1514em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.02691em"}},"w")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])])])])]),a("。按照如下公式计算边界框实际位置和大小（相对于特征图大小）：")],-1),Y=s("p",{class:"katex-block"},[s("span",{class:"katex-display"},[s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("semantics",null,[s("mrow",null,[s("msub",null,[s("mi",null,"b"),s("mi",null,"x")]),s("mo",null,"="),s("mi",null,"σ"),s("mo",{stretchy:"false"},"("),s("msub",null,[s("mi",null,"t"),s("mi",null,"x")]),s("mo",{stretchy:"false"},")"),s("mo",null,"+"),s("msub",null,[s("mi",null,"c"),s("mi",null,"x")]),s("mspace",{linebreak:"newline"}),s("msub",null,[s("mi",null,"b"),s("mi",null,"y")]),s("mo",null,"="),s("mi",null,"σ"),s("mo",{stretchy:"false"},"("),s("msub",null,[s("mi",null,"t"),s("mi",null,"y")]),s("mo",{stretchy:"false"},")"),s("mo",null,"+"),s("msub",null,[s("mi",null,"c"),s("mi",null,"y")]),s("mspace",{linebreak:"newline"}),s("msub",null,[s("mi",null,"b"),s("mi",null,"w")]),s("mo",null,"="),s("msub",null,[s("mi",null,"p"),s("mi",null,"w")]),s("msup",null,[s("mi",null,"e"),s("msub",null,[s("mi",null,"t"),s("mi",null,"w")])]),s("mspace",{linebreak:"newline"}),s("msub",null,[s("mi",null,"b"),s("mi",null,"h")]),s("mo",null,"="),s("msub",null,[s("mi",null,"p"),s("mi",null,"h")]),s("msup",null,[s("mi",null,"e"),s("msub",null,[s("mi",null,"t"),s("mi",null,"h")])])]),s("annotation",{encoding:"application/x-tex"}," b_x=\\sigma(t_x)+c_x \\\\ b_y = \\sigma(t_y)+c_y \\\\ b_w = p_we^{t_w} \\\\ b_h = p_he^{t_h} ")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8444em","vertical-align":"-0.15em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"b"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.1514em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight"},"x")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.03588em"}},"σ"),s("span",{class:"mopen"},"("),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"t"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.1514em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight"},"x")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mclose"},")"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"+"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.5806em","vertical-align":"-0.15em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"c"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.1514em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight"},"x")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])])]),s("span",{class:"mspace newline"}),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.9805em","vertical-align":"-0.2861em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"b"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.1514em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.03588em"}},"y")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.2861em"}},[s("span")])])])])]),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1.0361em","vertical-align":"-0.2861em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.03588em"}},"σ"),s("span",{class:"mopen"},"("),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"t"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.1514em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.03588em"}},"y")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.2861em"}},[s("span")])])])])]),s("span",{class:"mclose"},")"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"+"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.7167em","vertical-align":"-0.2861em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"c"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.1514em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.03588em"}},"y")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.2861em"}},[s("span")])])])])])]),s("span",{class:"mspace newline"}),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8444em","vertical-align":"-0.15em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"b"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.1514em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.02691em"}},"w")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1.038em","vertical-align":"-0.1944em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"p"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.1514em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.02691em"}},"w")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"e"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8436em"}},[s("span",{style:{top:"-3.113em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mathnormal mtight"},"t"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.1645em"}},[s("span",{style:{top:"-2.357em","margin-left":"0em","margin-right":"0.0714em"}},[s("span",{class:"pstrut",style:{height:"2.5em"}}),s("span",{class:"sizing reset-size3 size1 mtight"},[s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.02691em"}},"w")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.143em"}},[s("span")])])])])])])])])])])])])])]),s("span",{class:"mspace newline"}),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8444em","vertical-align":"-0.15em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"b"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3361em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight"},"h")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1.038em","vertical-align":"-0.1944em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"p"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3361em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight"},"h")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"e"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8436em"}},[s("span",{style:{top:"-3.113em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mathnormal mtight"},"t"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3448em"}},[s("span",{style:{top:"-2.3488em","margin-left":"0em","margin-right":"0.0714em"}},[s("span",{class:"pstrut",style:{height:"2.5em"}}),s("span",{class:"sizing reset-size3 size1 mtight"},[s("span",{class:"mord mathnormal mtight"},"h")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.1512em"}},[s("span")])])])])])])])])])])])])])])])])])],-1),M=s("p",null,[a("其中"),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mo",{stretchy:"false"},"("),s("msub",null,[s("mi",null,"c"),s("mi",null,"x")]),s("mo",{separator:"true"},","),s("msub",null,[s("mi",null,"c"),s("mi",null,"y")]),s("mo",{stretchy:"false"},")")]),s("annotation",{encoding:"application/x-tex"},"(c_x,c_y)")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1.0361em","vertical-align":"-0.2861em"}}),s("span",{class:"mopen"},"("),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"c"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.1514em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight"},"x")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mpunct"},","),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"c"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.1514em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.03588em"}},"y")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.2861em"}},[s("span")])])])])]),s("span",{class:"mclose"},")")])])]),a("是cell的左上角坐标。"),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msub",null,[s("mi",null,"p"),s("mi",null,"w")])]),s("annotation",{encoding:"application/x-tex"},"p_w")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.625em","vertical-align":"-0.1944em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"p"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.1514em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.02691em"}},"w")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])])])])]),a("和"),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msub",null,[s("mi",null,"p"),s("mi",null,"h")])]),s("annotation",{encoding:"application/x-tex"},"p_h")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.625em","vertical-align":"-0.1944em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"p"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3361em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight"},"h")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])])])])]),a("是先验框的宽度与长度，它们的也是相对于特征图大小的。")],-1),N=n('<h2 id="yolov2的训练" tabindex="-1"><a class="header-anchor" href="#yolov2的训练" aria-hidden="true">#</a> YOLOV2的训练</h2><p>YOLOv2的训练主要包括<strong>三个阶段</strong>。<strong>第一阶段</strong>就是先在ImageNet分类数据集上预训练Darknet-19，此时模型输入为 224x224 ，共训练160个epochs。然后<strong>第二阶段</strong>将网络的输入调整为 448x448 ，继续在ImageNet数据集上finetune分类模型，训练10个epochs，此时分类模型的top-1准确度为76.5%，而top-5准确度为93.3%。<strong>第三个阶段</strong>就是<strong>修改Darknet-19分类模型为检测模型</strong>，并在<strong>检测数据集上继续finetune网络</strong>。</p>',2),I=s("p",null,[s("strong",null,"网络的修改包括"),a("：移除最后一个卷积层、maxpooling层以及softmax层，并且新增了三个3x3x1024 卷积层，同时增加了一个passthrough层，最后使用 1x1 卷积层输出预测结果，输出的channels数为："),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mtext",null,"anchors"),s("mo",null,"×"),s("mo",{stretchy:"false"},"("),s("mn",null,"5"),s("mo",null,"+"),s("mtext",null,"classes"),s("mo",{stretchy:"false"},")")]),s("annotation",{encoding:"application/x-tex"},"\\text{anchors} \\times (5+\\text{classes})")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.7778em","vertical-align":"-0.0833em"}}),s("span",{class:"mord text"},[s("span",{class:"mord"},"anchors")]),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"×"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mopen"},"("),s("span",{class:"mord"},"5"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"+"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord text"},[s("span",{class:"mord"},"classes")]),s("span",{class:"mclose"},")")])])]),a("。从这里可以看出和v1的区别，"),s("strong",null,"v1是对每一个cell（每两个bbox）预测一个classes，这里是对每一个anchor都预测一个class"),a("。")],-1),D=s("p",null,[s("strong",null,"损失函数：")],-1),A=s("img",{src:h,title:"",alt:"","data-align":"center"},null,-1),U=s("p",null,[a("首先 W, H 分别指的是特征图（ 13x13 ）的宽与高，而 A 指的是先验框数目（这里是5），各个 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mi",null,"λ")]),s("annotation",{encoding:"application/x-tex"},"\\lambda")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.6944em"}}),s("span",{class:"mord mathnormal"},"λ")])])]),a(" 值是各个loss部分的权重系数。")],-1),V=n("<p>第一项loss是计算background的置信度误差，但是哪些预测框来预测背景呢，需要先计算<strong>各个预测框和所有ground truth的IOU值</strong>，并且取最大值Max_IOU，如果该值小于一定的阈值（YOLOv2使用的是0.6），那么这个预测框就标记为background，需要计算noobj的置信度误差。下面介绍匹配原则：</p><blockquote><p>匹配原则：对于某个ground truth，首先要确定其<strong>中心点要落在哪个cell上</strong>，然后计算这个cell的<strong>5个先验框与ground truth的IOU值</strong>（YOLOv2中bias_match=1），计算IOU值时不考虑坐标，只考虑形状，所以先将先验框与ground truth的<strong>中心点都偏移到同一位置</strong>（原点），然后计算出对应的IOU值，IOU值最大的那个先验框与ground truth匹配，对应的预测框用来预测这个ground truth。</p></blockquote><p>第二项是计算先验框与预测框的坐标误差，但是只在前12800个iterations间计算</p><p>第三大项计算与某个ground truth匹配的预测框各部分loss值，包括坐标误差、置信度误差以及分类误差</p><p>YOLO中<strong>一个ground truth只会与一个先验框匹配</strong>（IOU值最好的），对于那些IOU值超过一定阈值的先验框，其预测结果就忽略了。而<strong>SSD与RPN网络可以将一个ground truth分配给多个先验框</strong>。</p>",5),B=s("strong",null,"YOLOv1中采用的是平方根",-1),F=s("strong",null,"YOLOv2根据ground truth的大小对权重系数修正",-1),C=s("strong",null,"尺度较小的boxes其权重系数会更大一些，可以放大误差",-1),S={href:"https://link.zhihu.com/?target=http%3A//www.cnblogs.com/YiXiaoZhou/p/7429481.html",target:"_blank",rel:"noopener noreferrer"},P=n('<p>最终的YOLOv2模型在速度上比YOLOv1还快（<strong>采用了计算量更少的Darknet-19模型</strong>）。</p><h2 id="yolo9000" tabindex="-1"><a class="header-anchor" href="#yolo9000" aria-hidden="true">#</a> yolo9000</h2><p>YOLO9000是在YOLOv2的基础上提出的一种可以检测超过9000个类别的模型，其主要贡献点在于提出了一种<strong>分类和检测的联合训练策略</strong>。在YOLO中，边界框的预测其实并<strong>不依赖于物体的类别标签</strong>，<strong>检测数据集</strong>可以用来学习预测物体的<strong>边界框</strong>、<strong>置信度以及为物体分类</strong>，而对于<strong>分类数据集</strong>可以仅用来学习<strong>分类</strong>，但是其可以大大<strong>扩充模型所能检测的物体种类</strong>。</p><p>在COCO和ImageNet数据集上进行联合训练，遇到的第一问题是<strong>两者的类别并不是完全互斥的</strong>，比如&quot;Norfolk terrier&quot;和&quot;dog&quot;是<strong>从属关系</strong>，所以作者提出了一种层级分类方法（Hierarchical classification），主要思路是根据各个类别之间的<strong>从属关系</strong>（根据WordNet）建立一种树结构WordTree。</p><p>WordTree的每个节点的子节点都属于同一子类，对它们进行softmax处理。给出某个类别的预测概率时，需要找到其所在的位置，遍历从root到该位置的path，然后计算path上各个节点的概率之积。</p><p>在训练时，如果是<strong>检测样本</strong>，按照YOLOv2的loss计算误差，而对于<strong>分类样本</strong>，只计算<strong>分类误差</strong>。在预测时，YOLOv2给出的置信度就是 最大类别的概率（WordTree的根节点） ，同时会给<strong>出边界框位置</strong>以及一个<strong>树状概率图</strong>。在这个概率图中找到概率最高的路径，当达到某一个阈值时停止，就用当前节点表示预测的类别。</p>',6);function q(G,T){const t=i("ExternalLinkIcon");return m(),r("div",null,[s("div",u,[d,v,s("p",null,[s("a",y,[a("第三章：YOLO-V2改进细节详解-1-V2版本细节升级概述_哔哩哔哩_bilibili"),l(t)])]),s("p",null,[s("a",x,[a("目标检测|YOLOv2原理与实现(附YOLOv3) - 知乎 (zhihu.com)"),l(t)])]),s("p",null,[s("a",b,[a("【论文解读】Yolo三部曲解读——Yolov2 - 知乎 (zhihu.com)"),l(t)])]),_]),s("p",null,[a("YOLOv2论文全名为"),s("a",w,[a("YOLO9000: Better, Faster, Stronger"),l(t)]),a("，首先在YOLOv1的基础上提出了改进的YOLOv2，然后提出了一种"),z,a("，使用这种联合训练方法在COCO检测数据集和ImageNet分类数据集上训练出了YOLO9000模型，其可以检测超过9000多类物体。所以，这篇文章其实包含两个模型：YOLOv2和YOLO9000，不过后者是在前者基础上提出的，两者模型主体结构是一致的。")]),f,O,k,L,Y,M,N,I,D,A,U,V,s("p",null,[a("在计算boxes的 w 和 h 误差时，"),B,a("以降低boxes的大小对误差的影响，而"),F,a("：l.coord_scale * (2 - truth.w*truth.h)（这里w和h都归一化到(0,1))，这样对于"),C,a("，起到和YOLOv1计算平方根相似的效果（参考"),s("a",S,[a("YOLO v2 损失函数源码分析"),l(t)]),a("）。")]),P])}const R=e(g,[["render",q],["__file","yolov2.html.vue"]]);export{R as default};
