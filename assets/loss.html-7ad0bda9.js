import{_ as t,r as n,o as e,c as m,a as s,b as a,d as r,e as p}from"./app-aa9cafec.js";const c="/MLblogs/assets/2024-02-01-14-32-02-image-c60c548a.png",o={},i=s("h2",{id:"triplet",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#triplet","aria-hidden":"true"},"#"),a(" Triplet")],-1),h={href:"https://zhuanlan.zhihu.com/p/295512971",target:"_blank",rel:"noopener noreferrer"},d=s("p",null,"思路：让相似的样本之间距离更近，差别大的样本之间距离更远。",-1),u=s("ul",null,[s("li",null,"anchor是基准"),s("li",null,"positive是针对anchor的正样本，表示与anchor来自同一个人"),s("li",null,"negative是针对anchor的负样本")],-1),g=s("p",null,"一组（anchor, positive, negative）构成一个triplet。一个triplet loss定义为：",-1),x=s("p",{class:"katex-block"},[s("span",{class:"katex-display"},[s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("semantics",null,[s("mrow",null,[s("mi",null,"L"),s("mo",null,"="),s("mi",null,"max"),s("mo",null,"⁡"),s("mo",{stretchy:"false"},"("),s("mi",null,"d"),s("mo",{stretchy:"false"},"("),s("mi",null,"a"),s("mo",{separator:"true"},","),s("mi",null,"p"),s("mo",{stretchy:"false"},")"),s("mo",null,"+"),s("mi",null,"m"),s("mo",null,"−"),s("mi",null,"d"),s("mo",{stretchy:"false"},"("),s("mi",null,"a"),s("mo",{separator:"true"},","),s("mi",null,"n"),s("mo",{stretchy:"false"},")"),s("mo",{separator:"true"},","),s("mn",null,"0"),s("mo",{stretchy:"false"},")")]),s("annotation",{encoding:"application/x-tex"}," L=\\max(d(a, p) + m - d(a, n), 0) ")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.6833em"}}),s("span",{class:"mord mathnormal"},"L"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mop"},"max"),s("span",{class:"mopen"},"("),s("span",{class:"mord mathnormal"},"d"),s("span",{class:"mopen"},"("),s("span",{class:"mord mathnormal"},"a"),s("span",{class:"mpunct"},","),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord mathnormal"},"p"),s("span",{class:"mclose"},")"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"+"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.6667em","vertical-align":"-0.0833em"}}),s("span",{class:"mord mathnormal"},"m"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"−"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal"},"d"),s("span",{class:"mopen"},"("),s("span",{class:"mord mathnormal"},"a"),s("span",{class:"mpunct"},","),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord mathnormal"},"n"),s("span",{class:"mclose"},")"),s("span",{class:"mpunct"},","),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord"},"0"),s("span",{class:"mclose"},")")])])])])],-1),y=s("p",null,[a("最小化L的目标是：使得"),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mi",null,"d"),s("mo",{stretchy:"false"},"("),s("mi",null,"a"),s("mo",{separator:"true"},","),s("mi",null,"p"),s("mo",{stretchy:"false"},")")]),s("annotation",{encoding:"application/x-tex"},"d(a, p)")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal"},"d"),s("span",{class:"mopen"},"("),s("span",{class:"mord mathnormal"},"a"),s("span",{class:"mpunct"},","),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord mathnormal"},"p"),s("span",{class:"mclose"},")")])])]),a("接近0，"),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mi",null,"d"),s("mo",{stretchy:"false"},"("),s("mi",null,"a"),s("mo",{separator:"true"},","),s("mi",null,"n"),s("mo",{stretchy:"false"},")")]),s("annotation",{encoding:"application/x-tex"},"d(a, n)")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal"},"d"),s("span",{class:"mopen"},"("),s("span",{class:"mord mathnormal"},"a"),s("span",{class:"mpunct"},","),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord mathnormal"},"n"),s("span",{class:"mclose"},")")])])]),a("大于"),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mi",null,"d"),s("mo",{stretchy:"false"},"("),s("mi",null,"a"),s("mo",{separator:"true"},","),s("mi",null,"p"),s("mo",{stretchy:"false"},")"),s("mo",null,"+"),s("mi",null,"m")]),s("annotation",{encoding:"application/x-tex"},"d(a, p)+m")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal"},"d"),s("span",{class:"mopen"},"("),s("span",{class:"mord mathnormal"},"a"),s("span",{class:"mpunct"},","),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord mathnormal"},"p"),s("span",{class:"mclose"},")"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"+"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.4306em"}}),s("span",{class:"mord mathnormal"},"m")])])]),a("。")],-1),_=p('<p><strong>依据n和a的距离可以定义成三种类型的triplet</strong>：</p><img title="" src="'+c+'" alt="" data-align="center" width="274"><p>不同的triplet对模型的效果影响可能会很大。FaceNet这篇论文，作者是为每一对anchor和positive随机选择一个semi-hard negative构建semi-hard triplet。</p><p><strong>构造triplet的两种方式：Offline和Online</strong></p><p><strong>Offline：</strong></p><p>在训练<strong>每个epoch</strong>的开始阶段，计算训练集种所有的embedding，并挑选出所有的hard triplets和semi-hard triplets，并在该epoch内训练这些triplets.</p><p>这种方式不是很高效，因为每个epoch都需要遍历整个数据集来生产triplets。</p><p><strong>Online：</strong></p><p><strong>每个batch</strong>的输入，动态地计算有用的triplets。</p><p><strong>batch all</strong>：挑选出所有合规的triplets，将hard triplets和semi-hard triplets的loss平均</p>',10),f=s("p",null,[s("strong",null,"batch hard"),a(": 对于每个anchor，挑选出hardest positive p（"),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mi",null,"d"),s("mo",{stretchy:"false"},"("),s("mi",null,"a"),s("mo",{separator:"true"},","),s("mi",null,"p"),s("mo",{stretchy:"false"},")")]),s("annotation",{encoding:"application/x-tex"},"d(a,p)")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal"},"d"),s("span",{class:"mopen"},"("),s("span",{class:"mord mathnormal"},"a"),s("span",{class:"mpunct"},","),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord mathnormal"},"p"),s("span",{class:"mclose"},")")])])]),a(" 距离最大）和hardest negative  n（d(a, n) 距离最小）。")],-1);function w(k,b){const l=n("ExternalLinkIcon");return e(),m("div",null,[i,s("p",null,[s("a",h,[a("深度学习从入门到放飞自我：完全解析triplet loss - 知乎 (zhihu.com)"),r(l)])]),d,u,g,x,y,_,f])}const M=t(o,[["render",w],["__file","loss.html.vue"]]);export{M as default};
